# CFramework Systems

åŸºäº CFramework.Core çš„ç³»ç»Ÿæ‹“å±•åŒ…ï¼Œä¸º Unity æ¸¸æˆå¼€å‘æä¾›äº†ä¸€å¥—å®Œæ•´çš„ç³»ç»Ÿæ¨¡å—ï¼Œæ¶µç›–èµ„äº§ç®¡ç†ã€éŸ³é¢‘ç®¡ç†ã€å­˜æ¡£ç®¡ç†ã€UI ç®¡ç†ã€å®šæ—¶å™¨ã€åœºæ™¯ç®¡ç†å’Œ Unity å¯¹è±¡å®¹å™¨ç­‰åŠŸèƒ½ã€‚

[![Unity Version](https://img.shields.io/badge/Unity-2021.3%2B-blue.svg)](https://unity.com/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![zread](https://img.shields.io/badge/Ask_Zread-_.svg?style=flat&color=00b0aa&labelColor=000000&logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTQuOTYxNTYgMS42MDAxSDIuMjQxNTZDMS44ODgxIDEuNjAwMSAxLjYwMTU2IDEuODg2NjQgMS42MDE1NiAyLjI0MDFWNC45NjAxQzEuNjAxNTYgNS4zMTM1NiAxLjg4ODEgNS42MDAxIDIuMjQxNTYgNS42MDAxSDQuOTYxNTZDNS4zMTUwMiA1LjYwMDEgNS42MDE1NiA1LjMxMzU2IDUuNjAxNTYgNC45NjAxVjIuMjQwMUM1LjYwMTU2IDEuODg2NjQgNS4zMTUwMiAxLjYwMDEgNC45NjE1NiAxLjYwMDFaIiBmaWxsPSIjZmZmIi8%2BCjxwYXRoIGQ9Ik00Ljk2MTU2IDEwLjM5OTlIMi4yNDE1NkMxLjg4ODEgMTAuMzk5OSAxLjYwMTU2IDEwLjY4NjQgMS42MDE1NiAxMS4wMzk5VjEzLjc1OTlDMS42MDE1NiAxNC4xMTM0IDEuODg4MSAxNC4zOTk5IDIuMjQxNTYgMTQuMzk5OUg0Ljk2MTU2QzUuMzE1MDIgMTQuMzk5OSA1LjYwMTU2IDE0LjExMzQgNS42MDE1NiAxMy43NTk5VjExLjAzOTlDNS42MDE1NiAxMC42ODY0IDUuMzE1MDIgMTAuMzk5OSA0Ljk2MTU2IDEwLjM5OTlaIiBmaWxsPSIjZmZmIi8%2BCjxwYXRoIGQ9Ik0xMy43NTg0IDEuNjAwMUgxMS4wMzg0QzEwLjY4NSAxLjYwMDEgMTAuMzk4NCAxLjg4NjY0IDEwLjM5ODQgMi4yNDAxVjQuOTYwMUMxMC4zOTg0IDUuMzEzNTYgMTAuNjg1IDUuNjAwMSAxMS4wMzg0IDUuNjAwMUgxMy43NTg0QzE0LjExMTkgNS42MDAxIDE0LjM5ODQgNS4zMTM1NiAxNC4zOTg0IDQuOTYwMVYyLjI0MDFDMTQuMzk4NCAxLjg4NjY0IDE0LjExMTkgMS42MDAxIDEzLjc1ODQgMS42MDAxWiIgZmlsbD0iI2ZmZiIvPgo8cGF0aCBkPSJNNCAxMkwxMiA0TDQgMTJaIiBmaWxsPSIjZmZmIi8%2BCjxwYXRoIGQ9Ik00IDEyTDEyIDQiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4K&logoColor=ffffff)](https://zread.ai/cnoom/CFramewrok-System)
## ç‰¹æ€§

### æ ¸å¿ƒç³»ç»Ÿæ¨¡å—

- **ğŸ“¦ AssetsSystem** - åŸºäº Unity Addressables çš„èµ„æºç®¡ç†ç³»ç»Ÿ
  - å•èµ„æºå’Œæ‰¹é‡èµ„æºåŠ è½½
  - å¼•ç”¨è®¡æ•°ç®¡ç†å’Œè‡ªåŠ¨é‡Šæ”¾
  - èµ„æºåŠ è½½è¿›åº¦è·Ÿè¸ª
  - çµæ´»çš„èµ„æºæ¥æ”¶å™¨æ¨¡å¼

- **ğŸµ AudioSystem** - å®Œæ•´çš„éŸ³é¢‘ç®¡ç†ç³»ç»Ÿ
  - èƒŒæ™¯éŸ³ä¹æ·¡å…¥æ·¡å‡ºå’Œ Crossfade
  - éŸ³æ•ˆå¯¹è±¡æ± ç®¡ç†
  - Master/Music/SFX ä¸‰çº§éŸ³é‡æ§åˆ¶
  - éŸ³é¢‘è®¾ç½®è‡ªåŠ¨æŒä¹…åŒ–
  - å…¨å±€æš‚åœæ”¯æŒ

- **ğŸ’¾ SaveSystem** - å¯é çš„å­˜æ¡£ç®¡ç†ç³»ç»Ÿ
  - å¤šæ¡£æ¡ˆï¼ˆProfileï¼‰å¤šæ§½ä½ï¼ˆSlotï¼‰æ”¯æŒ
  - è„æ•°æ®æ£€æµ‹å’Œè‡ªåŠ¨ä¿å­˜
  - åŸå­å†™å…¥ä¿è¯æ•°æ®å®‰å…¨
  - JSON åºåˆ—åŒ–

- **ğŸ¨ UISystem** - å¼ºå¤§çš„ UI ç®¡ç†ç³»ç»Ÿ
  - å¤šå±‚çº§ UI ç®¡ç†
  - UI å¯¹è±¡æ± ä¼˜åŒ–
  - çµæ´»çš„è¿‡æ¸¡åŠ¨ç”»
  - å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

- **â±ï¸ TimerSystem** - é«˜æ•ˆçš„å®šæ—¶å™¨ç³»ç»Ÿ
  - å•æ¬¡å’Œå¾ªç¯å®šæ—¶å™¨
  - æ ‡ç­¾åˆ†ç»„ç®¡ç†
  - æš‚åœ/æ¢å¤æ§åˆ¶
  - æ”¯æŒç¼©æ”¾å’Œéç¼©æ”¾æ—¶é—´

- **ğŸ¬ SceneSystem** - åœºæ™¯ç®¡ç†ç³»ç»Ÿ
  - åœºæ™¯åŠ è½½/å¸è½½
  - åœºæ™¯åˆ‡æ¢å’Œè¿›åº¦è·Ÿè¸ª

- **ğŸ”— UnityContainerSystem** - Unity å¯¹è±¡å®¹å™¨ç³»ç»Ÿ
  - å¯¹è±¡è‡ªåŠ¨ç»‘å®š
  - ä½œç”¨åŸŸéš”ç¦»
  - ç»„ä»¶å¿«é€ŸæŸ¥è¯¢
  - å¹¶å‘å®‰å…¨

### ç¼–è¾‘å™¨å·¥å…·

- **Addressable å·¥å…·**
  - ä»£ç ç”Ÿæˆå’Œé…ç½®ç®¡ç†
  - å³é”®èœå•å¿«æ·æ“ä½œ
  - èµ„æºæ–‡ä»¶å¤¹è‡ªåŠ¨åŒæ­¥

- **ç³»ç»Ÿé…ç½®ç¼–è¾‘å™¨**
  - AudioConfig å¯è§†åŒ–é…ç½®
  - UIConfig ç•Œé¢é…ç½®
  - SaveSystem å­˜æ¡£ç®¡ç†

### å·¥å…·ç±»åº“

- **Extensions** - ä¸°å¯Œçš„æ‰©å±•æ–¹æ³•
  - Colorã€GameObjectã€Transformã€Vector ç­‰
  - çŠ¶æ€æœºæ‰©å±•
  - æ•°å­—è½¬æ¢æ‰©å±•

- **Utilities** - å®ç”¨å·¥å…·ç±»
  - FSMï¼ˆæœ‰é™çŠ¶æ€æœºï¼‰
  - Blackboardï¼ˆé»‘æ¿æ•°æ®å­˜å‚¨ï¼‰
  - EasyEventï¼ˆè½»é‡çº§äº‹ä»¶ï¼‰
  - GuideMaskï¼ˆæ–°æ‰‹å¼•å¯¼é®ç½©ï¼‰

## å®‰è£…

### é€šè¿‡ Package Manager å®‰è£…

1. åœ¨ Unity é¡¹ç›®çš„ `Packages/manifest.json` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```json
{
  "dependencies": {
    "com.cnoom.cframework": "https://github.com/cnoom/CFramework.Systems.git#upm",
    "com.unity.nuget.newtonsoft-json": "3.2.1",
    "com.cysharp.unitask": "2.5.1",
    "com.unity.addressables": "1.22.3"
  }
}
```

2. ç¡®ä¿å·²å®‰è£… CFramework.Core ä½œä¸ºåŸºç¡€ä¾èµ–

3. é‡æ–°æ‰“å¼€é¡¹ç›®æˆ–ç‚¹å‡» Package Manager ä¸­çš„æ›´æ–°æŒ‰é’®

### æ‰‹åŠ¨å®‰è£…

1. ä¸‹è½½æœ¬ä»“åº“
2. å°† `Assets/com.cnoom.cframework.systems` æ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ‚¨çš„ Unity é¡¹ç›®ä¸­
3. ç¡®ä¿é¡¹ç›®åŒ…å«æ‰€éœ€çš„ä¾èµ–é¡¹

## å¿«é€Ÿå¼€å§‹

### åˆå§‹åŒ–æ¡†æ¶

1. åœ¨æŒ‡å®šçš„åœºæ™¯æ–°å»ºä¸€ä¸ª GameObject
2. å°† `CFrameworkUnityEntry` ç»„ä»¶æ·»åŠ åˆ°è¯¥ GameObject ä¸Š
3. å°† `Assets/CFramework/Config/CFrameworkConfig.asset` æ‹–æ‹½åˆ° `CFrameworkUnityEntry` æ‰€éœ€ä½ç½®å³å¯

æ¡†æ¶ä¼šè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œæ‰€æœ‰å¸¦æœ‰ `[AutoModule]` ç‰¹æ€§çš„æ¨¡å—ï¼Œæ— éœ€æ‰‹åŠ¨æ³¨å†Œã€‚

### ä½¿ç”¨ç¤ºä¾‹

#### æ’­æ”¾éŸ³é¢‘

```csharp
using CFramework.Core;
using CFramework.Systems.AudioSystem;

// æ’­æ”¾èƒŒæ™¯éŸ³ä¹
CF.Execute(new AudioCommands.PlayMusic(
    clipKey: "BGM_MainMenu",
    fadeInSeconds: 1.5f,
    fadeOutInSeconds: 0.5f,
    loop: true
)).Forget();

// æ’­æ”¾éŸ³æ•ˆ
CF.Execute(new AudioCommands.PlaySfx(
    clipKey: "SFX_Click",
    volume: 0.8f,
    pitch: 1.0f
)).Forget();

// è®¾ç½®éŸ³é‡
CF.Execute(new AudioCommands.SetVolume(
    category: AudioCategory.Music,
    volume: 0.7f
)).Forget();
```

#### å­˜æ¡£ç®¡ç†

```csharp
using CFramework.Core;
using CFramework.Systems.SaveSystem;
using CFramework.Systems.SaveSystem.Data;

// è·å–å½“å‰å­˜æ¡£æ§½ä½
Slot saveSlot = await CF.Query<SaveQueries.CurrentProfileSlot, Slot>(
    new SaveQueries.CurrentProfileSlot("player_data")
);

// ä¿å­˜æ•°æ®
saveSlot.SetInt("level", 5);
saveSlot.SetFloat("health", 100.0f);
saveSlot.SetString("player_name", "Hero");

// æäº¤ä¿å­˜
CF.Execute(new SaveCommands.SaveSlot("player_data")).Forget();

// è¯»å–æ•°æ®
int level = saveSlot.GetInt("level", 1);
float health = saveSlot.GetFloat("health", 0.0f);
string playerName = saveSlot.GetString("player_name", "");
```

#### UI ç®¡ç†

```csharp
using CFramework.Core;
using CFramework.Systems.UISystem;

// æ‰“å¼€ UI
CF.Execute(new UICommands.OpenView(
    key: "MainMenuPanel",
    layer: "Normal",
    transitionName: "Fade",
    seconds: 0.3f
)).Forget();

// å…³é—­ UI
CF.Execute(new UICommands.CloseTop(
    layer: "Normal",
    seconds: 0.3f
)).Forget();

// æŸ¥è¯¢å½“å‰æ‰“å¼€çš„ UI
ViewInfo[] openViews = await CF.Query<UIQueries.GetOpenViews, ViewInfo[]>(
    new UIQueries.GetOpenViews("Normal")
);
```

#### å®šæ—¶å™¨ä½¿ç”¨

```csharp
using CFramework.Core;
using CFramework.Systems.TimerSystem;

// å¯åŠ¨å®šæ—¶å™¨
CF.Execute(new TimerCommands.StartTimer(
    id: "cooldown_timer",
    durationSeconds: 5.0f,
    loop: false,
    tag: "cooldown"
)).Forget();

// ç›‘å¬å®šæ—¶å™¨å®Œæˆäº‹ä»¶
CF.Listen<TimerBroadcasts.TimerCompleted>(evt =>
{
    Debug.Log($"Timer {evt.Id} completed!");
});

// æš‚åœ/æ¢å¤å®šæ—¶å™¨
CF.Execute(new TimerCommands.PauseTimer("cooldown_timer")).Forget();
CF.Execute(new TimerCommands.ResumeTimer("cooldown_timer")).Forget();
```

#### åŠ è½½èµ„æº

```csharp
using CFramework.Core;
using CFramework.Systems.AssetsSystem;

// åŠ è½½å•ä¸ªèµ„æº
GameObject prefab = await CF.Query<AssetsQueries.Asset, GameObject>(
    new AssetsQueries.Asset("PlayerPrefab")
);

// åŠ è½½æ‰¹é‡èµ„æº
AudioClip[] audioClips = await CF.Query<AssetsQueries.Assets, AudioClip[]>(
    new AssetsQueries.Assets("AllSFX")
);

// é‡Šæ”¾èµ„æº
CF.Execute(new AssetsCommands.ReleaseAsset<GameObject>("PlayerPrefab")).Forget();
```

## ç³»ç»Ÿè¯¦è§£

### AssetsSystem

èµ„æºç®¡ç†ç³»ç»ŸåŸºäº Unity Addressablesï¼Œæä¾›äº†æ›´åŠ ä¾¿æ·çš„åŠ è½½å’Œç®¡ç†æ¥å£ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- å¼‚æ­¥èµ„æºåŠ è½½
- å¼•ç”¨è®¡æ•°è‡ªåŠ¨ç®¡ç†
- è¿›åº¦è·Ÿè¸ªå’Œå›è°ƒ
- è‡ªå®šä¹‰èµ„æºæ¥æ”¶å™¨

**é…ç½®ï¼š**
ç¡®ä¿ Addressables ç»„å·²æ­£ç¡®é…ç½®ï¼Œå¹¶è®¾ç½®åˆé€‚çš„æ ‡ç­¾ã€‚

### AudioSystem

éŸ³é¢‘ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„èƒŒæ™¯éŸ³ä¹å’ŒéŸ³æ•ˆç®¡ç†åŠŸèƒ½ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- åŒéŸ³æº Crossfade å®ç°
- éŸ³æ•ˆå¯¹è±¡æ± ä¼˜åŒ–æ€§èƒ½
- éŸ³é‡åˆ†çº§æ§åˆ¶
- è®¾ç½®è‡ªåŠ¨æŒä¹…åŒ–

**é…ç½®ï¼š**
åˆ›å»º `AudioConfig` ScriptableObject å¹¶é…ç½®é»˜è®¤éŸ³é‡ã€æ± å¤§å°ç­‰å‚æ•°ã€‚

### SaveSystem

å­˜æ¡£ç³»ç»Ÿä½¿ç”¨ JSON åºåˆ—åŒ–ï¼Œæ”¯æŒå¤šæ¡£æ¡ˆå¤šæ§½ä½ç®¡ç†ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- å¤šæ¡£æ¡ˆéš”ç¦»
- åŸå­å†™å…¥ä¿è¯å®‰å…¨
- è„æ•°æ®è‡ªåŠ¨ä¿å­˜
- ç±»å‹å®‰å…¨çš„æ•°æ®è®¿é—®

**æ•°æ®å­˜å‚¨è·¯å¾„ï¼š**
```
{Application.persistentDataPath}/cframework/saves/{profileId}/{slotId}.json
```

### UISystem

UI ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„è§†å›¾ç®¡ç†åŠŸèƒ½ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- å¤šå±‚çº§ç®¡ç†
- å¯¹è±¡æ± ä¼˜åŒ–
- è¿‡æ¸¡åŠ¨ç”»æ”¯æŒ
- ç”Ÿå‘½å‘¨æœŸé’©å­
- é”™è¯¯é‡è¯•æœºåˆ¶

**è§†å›¾ç”Ÿå‘½å‘¨æœŸï¼š**
```
Create â†’ ShowBefore â†’ Show â†’ Hide â†’ Close
```

**é…ç½®ï¼š**
åˆ›å»º `UIConfig` ScriptableObject å¹¶é…ç½®å±‚çº§ã€è¿‡æ¸¡æ•ˆæœç­‰å‚æ•°ã€‚

### TimerSystem

å®šæ—¶å™¨ç³»ç»Ÿæä¾›äº†é«˜æ•ˆçš„å®šæ—¶ä»»åŠ¡ç®¡ç†ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- å•æ¬¡/å¾ªç¯è§¦å‘
- æ ‡ç­¾åˆ†ç»„
- æš‚åœ/æ¢å¤
- ç¼©æ”¾/éç¼©æ”¾æ—¶é—´

### UnityContainerSystem

Unity å¯¹è±¡å®¹å™¨ç³»ç»Ÿæä¾›äº†å¯¹è±¡è‡ªåŠ¨ç»‘å®šå’ŒæŸ¥è¯¢åŠŸèƒ½ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- è‡ªåŠ¨ç»‘å®š GameObject å’Œç»„ä»¶
- ä½œç”¨åŸŸéš”ç¦»
- å¹¶å‘å®‰å…¨
- ç»„ä»¶å¿«é€ŸæŸ¥è¯¢

## ç¼–è¾‘å™¨å·¥å…·

### Addressable å·¥å…·

æä¾›äº†ä»¥ä¸‹å¿«æ·æ“ä½œï¼š
- å³é”®èœå•ç”Ÿæˆ Addressable ä»£ç 
- æ–‡ä»¶å¤¹è‡ªåŠ¨åŒæ­¥ Addressable é…ç½®
- å¯è§†åŒ–ç®¡ç†çª—å£

è®¿é—®è·¯å¾„ï¼š`Assets > Create > CFramework > Addressable`

### UI é…ç½®å·¥å…·

å¯è§†åŒ–é…ç½® UI å±‚çº§å’Œè¿‡æ¸¡æ•ˆæœã€‚

è®¿é—®è·¯å¾„ï¼š`CFramework > UI Config`

## ä¾èµ–é¡¹

- **CFramework.Core** - åŸºç¡€æ¡†æ¶ï¼ˆå¿…é¡»ï¼‰
- **Unity 2021.3+** - Unity ç‰ˆæœ¬è¦æ±‚
- **com.unity.addressables** (1.22.3) - Addressable Asset System
- **com.cysharp.unitask** (2.5.1) - å¼‚æ­¥ä»»åŠ¡åº“
- **com.unity.nuget.newtonsoft-json** (3.2.1) - JSON åºåˆ—åŒ–

## æ¶æ„è®¾è®¡

### æ¨¡å—åŒ–è®¾è®¡

æ¯ä¸ªç³»ç»Ÿéƒ½æ˜¯ç‹¬ç«‹çš„æ¨¡å—ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š
- **å•ä¸€èŒè´£** - æ¯ä¸ªç³»ç»Ÿä¸“æ³¨äºç‰¹å®šåŠŸèƒ½
- **æ¾è€¦åˆ** - ç³»ç»Ÿé—´é€šè¿‡ Command/Query/Broadcast é€šä¿¡
- **å¯æ‰©å±•** - æ”¯æŒè‡ªå®šä¹‰æ‰©å±•å’Œé…ç½®

### é€šä¿¡æœºåˆ¶

```csharp
// Command - æ‰§è¡Œå‘½ä»¤
CF.Execute(new SomeCommand()).Forget();

// Query - æŸ¥è¯¢æ•°æ®
var result = await CF.Query<SomeQuery, TResult>(new SomeQuery());

// Broadcast - å¹¿æ’­äº‹ä»¶
CF.Broadcast(new SomeEvent()).Forget();
```

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

åœ¨æäº¤ PR ä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š
1. ä»£ç ç¬¦åˆé¡¹ç›®ç¼–ç è§„èŒƒ
2. æ·»åŠ å¿…è¦çš„å•å…ƒæµ‹è¯•
3. æ›´æ–°ç›¸å…³æ–‡æ¡£
4. é€šè¿‡æ‰€æœ‰ CI æ£€æŸ¥

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ä½œè€…

**Cnoom** - [GitHub](https://github.com/cnoom) - cnoom@qq.com

## è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸º CFramework åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

## ç›¸å…³é“¾æ¥

- [CFramework.Core](https://github.com/cnoom/CFramewrok-Core) - åŸºç¡€æ¡†æ¶
- [Unity Addressables](https://docs.unity3d.com/Packages/com.unity.addressables@latest) - Addressable èµ„æºç³»ç»Ÿæ–‡æ¡£
- [UniTask](https://github.com/Cysharp/UniTask) - å¼‚æ­¥ä»»åŠ¡åº“

---

**Made with â¤ï¸ by Cnoom**
